package commCalc;

import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.PasswordAuthentication;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Scanner;
import java.util.Properties;

public class CommCalc {

	public static void main(String[] args) {

		Scanner scanner = new Scanner(System.in);
		BufferedWriter bw = null;
		BufferedWriter bwcomm = null;

		
		// v v Initial data entry
		System.out.println("Enter first name: ");
		String firstName = scanner.nextLine();
		System.out.println("Enter last name: ");
		String lastName = scanner.nextLine();
		System.out.println("Enter product: ");
		String product = scanner.nextLine();
		System.out.println("Comments: ");
		String comments = scanner.nextLine();
		System.out.println("Date: ");
		String date = scanner.nextLine();
		System.out.println("Credit status: ");
		String credstat = scanner.nextLine();

		try {
			// v v This is to track basic appointment data
			bw = new BufferedWriter(new FileWriter("custinfo.txt", true));
			bw.write(firstName);
			bw.write(" ");
			bw.write(lastName);
			bw.newLine();
			bw.write(product);
			bw.newLine();
			bw.write(comments);
			bw.newLine();
			bw.write(date);
			bw.newLine();
			bw.flush();

		} catch (IOException e) {
			e.printStackTrace();
		}

		System.out.println("Enter book price: ");
		double book = scanner.nextDouble();

		System.out.println("Enter actual price: ");
		double actual = scanner.nextDouble();

		// v v Commission calculations
		double drop = ((book - actual) / book);

		double commperc = (.48 - (drop)) / 2;

		// v v Big IF statement that determines different outcomes based on how deep the rep discounted the price
		if (drop > .48) {
			System.out.println("Dropped " + 100 * drop
					+ " %, which is greater than a 48% drop. Diller will sarcastically tell you this later when you ask why your commission sucks. Commission is 0.");

			String commish = "0";
			String of = " of ";
			double bookprice = .24 * book * .7;
			String soldfor = "...sold for ";
			double actualprice = actual;
			String creddesc = "  Credit is ";
			String credit = credstat;

			try {
				bw = new BufferedWriter(new FileWriter("custinfo.txt", true));
				bw.write(String.valueOf(0));
				bw.write(" / ");
				bw.write(String.valueOf(actual));
				bw.newLine();
				bw.write(String.valueOf("----"));
				bw.newLine();
				bw.flush();
				bwcomm = new BufferedWriter(new FileWriter("totalcommissions.txt", true));
				bwcomm.write(String.valueOf(0));
				bwcomm.newLine();
				bwcomm.flush();

			} catch (IOException e) {
				e.printStackTrace();
			}

			scanner.next();

			String to = "wmsaint17@gmail.com";

			String from = "wyatt.saint@aspenwindows.com";

			String host = "smtp.gmail.com";

			Properties properties = System.getProperties();

			properties.put("mail.smtp.host", host);
			properties.put("mail.smtp.port", "465");
			properties.put("mail.smtp.ssl.enable", "true");
			properties.put("mail.smtp.auth", "true");

			Session session = Session.getInstance(properties, new javax.mail.Authenticator() {

				protected PasswordAuthentication getPasswordAuthentication() {

					return new PasswordAuthentication("wyatt.saint@aspenwindows.com", "Swatts0429*");

				}

			});

			session.setDebug(true);

			try {
				MimeMessage message = new MimeMessage(session);

				message.setFrom(new InternetAddress(from));

				message.addRecipient(Message.RecipientType.TO, new InternetAddress(to));

				message.setSubject("SOLD!!");

				message.setText(String.valueOf(commish + of + bookprice + soldfor + actualprice + creddesc + credit));

				System.out.println("sending...");
				Transport.send(message);
				System.out.println("Sent message successfully....");
			} catch (MessagingException mex) {
				mex.printStackTrace();
			}
		}

		else if (drop > .44) {
			System.out.println(
					"Dropped " + 100 * drop + " %, which is greater than a 44% drop but less than 48%. Commission is "
							+ .02 * actual * .7 + " of " + .24 * book * .7);

			double commish = .02 * actual * .7;
			String of = " of ";
			double bookprice = .24 * book;
			String soldfor = "...sold for ";
			double actualprice = actual;
			String creddesc = "  Credit is ";
			String credit = credstat;

			try {
				bw = new BufferedWriter(new FileWriter("custinfo.txt", true));
				bw.write(String.valueOf(.02 * actual * .7));
				bw.write(" / ");
				bw.write(String.valueOf(actual));
				bw.newLine();
				bw.write(String.valueOf("----"));
				bw.newLine();
				bw.flush();
				bwcomm = new BufferedWriter(new FileWriter("totalcommissions.txt", true));
				bwcomm.write(String.valueOf(.02 * actual * .7));
				bwcomm.newLine();
				bwcomm.flush();

			} catch (IOException e) {
				e.printStackTrace();
			}

			scanner.next();

			String to = "wmsaint17@gmail.com";

			String from = "wyatt.saint@aspenwindows.com";

			String host = "smtp.gmail.com";

			Properties properties = System.getProperties();

			properties.put("mail.smtp.host", host);
			properties.put("mail.smtp.port", "465");
			properties.put("mail.smtp.ssl.enable", "true");
			properties.put("mail.smtp.auth", "true");

			Session session = Session.getInstance(properties, new javax.mail.Authenticator() {

				protected PasswordAuthentication getPasswordAuthentication() {

					return new PasswordAuthentication("wyatt.saint@aspenwindows.com", "Swatts0429*");

				}

			});

			session.setDebug(true);

			try {

				MimeMessage message = new MimeMessage(session);

				message.setFrom(new InternetAddress(from));

				message.addRecipient(Message.RecipientType.TO, new InternetAddress(to));

				message.setSubject("SOLD!!");

				message.setText(String.valueOf(commish + of + bookprice + soldfor + actualprice + creddesc + credit));

				System.out.println("sending...");
				Transport.send(message);
				System.out.println("Sent message successfully....");
			} catch (MessagingException mex) {
				mex.printStackTrace();
			}
		}

		else {
			double comm = commperc * actual * .7;
			System.out.println("Dropped " + 100 * drop + " %. Commission is " + comm + " of " + .24 * book * .7);

			double commish = comm;
			String of = " of ";
			double bookprice = .24 * book * .7;
			String soldfor = "...sold for ";
			double actualprice = actual;
			String creddesc = "  Credit is ";
			String credit = credstat;

			try {
				// v v This is to track commissions and actual sold for price
				bw = new BufferedWriter(new FileWriter("custinfo.txt", true));
				bw.write(String.valueOf(comm));
				bw.write(" / ");
				bw.write(String.valueOf(actual));
				bw.newLine();
				bw.write(String.valueOf("----"));
				bw.newLine();
				bw.flush();
				// v v This is for tracking commissions earned
				bwcomm = new BufferedWriter(new FileWriter("totalcommissions.txt"));
				bwcomm.write(String.valueOf(comm));
				bwcomm.flush();
				

			} catch (IOException e) {
				e.printStackTrace();
			}

			scanner.next();
			scanner.close();
			String to = "wmsaint17@gmail.com";

			String from = "wyatt.saint@aspenwindows.com";

			String host = "smtp.gmail.com";

			Properties properties = System.getProperties();

			properties.put("mail.smtp.host", host);
			properties.put("mail.smtp.port", "465");
			properties.put("mail.smtp.ssl.enable", "true");
			properties.put("mail.smtp.auth", "true");

			Session session = Session.getInstance(properties, new javax.mail.Authenticator() {

				protected PasswordAuthentication getPasswordAuthentication() {

					return new PasswordAuthentication("wyatt.saint@aspenwindows.com", "Swatts0429*");

				}

			});

			session.setDebug(true);

			try {
				MimeMessage message = new MimeMessage(session);

				message.setFrom(new InternetAddress(from));

				message.addRecipient(Message.RecipientType.TO, new InternetAddress(to));

				message.setSubject("SOLD!!");

				message.setText(String.valueOf(commish + of + bookprice + soldfor + actualprice + creddesc + credit));

				System.out.println("sending...");
				Transport.send(message);
				System.out.println("Sent message successfully....");
			} catch (MessagingException mex) {
				mex.printStackTrace();
			}
//This is for adding total commissions made
			

			String linecontent;

			try {
				linecontent = Files.readAllLines(Paths.get("totalcommissions.txt")).get(0);
				double commofline = Double.parseDouble(linecontent);
				System.out.println(commofline);
				double commadd = commofline + comm;
				System.out.println(commadd);
				bwcomm = new BufferedWriter(new FileWriter("totalcommissions.txt"));
				bwcomm.write(String.valueOf(commadd));
				bwcomm.flush();
			}

			catch (IOException e) {
				e.printStackTrace();
			}
		}


	}
}
